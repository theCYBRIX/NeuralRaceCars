[gd_scene load_steps=13 format=3 uid="uid://ccrhr53h8iyim"]

[ext_resource type="Script" path="res://scripts/game_area.gd" id="1_iaiwh"]
[ext_resource type="PackedScene" uid="uid://c33sfflw13k51" path="res://scenes/neural_car_manager.tscn" id="1_jkvqb"]
[ext_resource type="PackedScene" uid="uid://51yasc5hk4v6" path="res://scenes/track_2.tscn" id="2_6sj2g"]
[ext_resource type="PackedScene" uid="uid://bo3ui0wlk1dqt" path="res://components/camera_manager.tscn" id="3_elaeq"]
[ext_resource type="Script" path="res://components/neural_api_client.gd" id="3_mf48n"]
[ext_resource type="PackedScene" uid="uid://bji248xsn4q3q" path="res://scenes/ui/graph.tscn" id="3_q1c5e"]
[ext_resource type="Script" path="res://components/network_layout_generator.gd" id="5_eies5"]
[ext_resource type="Script" path="res://components/console_io_handler.gd" id="7_lq4ur"]
[ext_resource type="Script" path="res://components/server_io_handler.gd" id="8_xv0p0"]
[ext_resource type="Texture2D" uid="uid://c8ybn1ts1xxbf" path="res://assets/popout_white.png" id="10_roe6o"]
[ext_resource type="Script" path="res://components/popout_component.gd" id="11_87okm"]

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_xt7i1"]
bg_color = Color(0.15967, 0.15967, 0.15967, 1)
border_width_left = 2
border_width_top = 2
border_width_right = 2
border_width_bottom = 2
border_color = Color(0.166853, 0.166853, 0.166853, 1)
corner_radius_top_left = 20
corner_radius_top_right = 20
corner_radius_bottom_right = 20
corner_radius_bottom_left = 20

[node name="GameArea" type="Node2D"]
script = ExtResource("1_iaiwh")
track_scene = ExtResource("2_6sj2g")

[node name="CameraManager" parent="." instance=ExtResource("3_elaeq")]

[node name="NeuralAPIClient" type="Node" parent="." node_paths=PackedStringArray("io_handler")]
script = ExtResource("3_mf48n")
io_handler = NodePath("ConsoleIOHandler")
print_error_stack_trace = false

[node name="NeuralCarManager" parent="NeuralAPIClient" node_paths=PackedStringArray("api_client") instance=ExtResource("1_jkvqb")]
api_client = NodePath("..")
num_networks = 200
gens_without_improvement_limit = 50
parent_selection = 4

[node name="NetworkLayoutGenerator" type="Node" parent="NeuralAPIClient"]
script = ExtResource("5_eies5")
num_inputs = 15
num_outputs = 4
hidden_layer_sizes = Array[int]([11])
activation_functions = Array[int]([0, 1, 0])
input_normalizers = Array[int]([1, 0, 0])

[node name="ConsoleIOHandler" type="Node" parent="NeuralAPIClient"]
process_thread_group = 2
process_thread_group_order = 0
process_thread_messages = 0
script = ExtResource("7_lq4ur")
autostart = true

[node name="ServerIOHandler" type="Node" parent="NeuralAPIClient"]
process_thread_group = 2
process_thread_group_order = 0
process_thread_messages = 0
script = ExtResource("8_xv0p0")
host_address = "localhost"
host_port = 3050

[node name="CanvasLayer" type="CanvasLayer" parent="."]

[node name="StatScreen" type="Control" parent="CanvasLayer"]
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_force_pass_scroll_events = false

[node name="ColorRect2" type="ColorRect" parent="CanvasLayer/StatScreen"]
visible = false
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2

[node name="ColorRect" type="ColorRect" parent="CanvasLayer/StatScreen"]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
color = Color(0, 0, 0, 0.745098)

[node name="MarginContainer" type="MarginContainer" parent="CanvasLayer/StatScreen"]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
theme_override_constants/margin_left = 20
theme_override_constants/margin_top = 20
theme_override_constants/margin_right = 20
theme_override_constants/margin_bottom = 20

[node name="Columns" type="HBoxContainer" parent="CanvasLayer/StatScreen/MarginContainer"]
layout_mode = 2

[node name="Items" type="VBoxContainer" parent="CanvasLayer/StatScreen/MarginContainer/Columns"]
layout_mode = 2
size_flags_horizontal = 3

[node name="PanelContainer2" type="PanelContainer" parent="CanvasLayer/StatScreen/MarginContainer/Columns/Items"]
layout_mode = 2
theme_override_styles/panel = SubResource("StyleBoxFlat_xt7i1")

[node name="MarginContainer" type="MarginContainer" parent="CanvasLayer/StatScreen/MarginContainer/Columns/Items/PanelContainer2"]
layout_mode = 2
theme_override_constants/margin_left = 10
theme_override_constants/margin_top = 10
theme_override_constants/margin_right = 10
theme_override_constants/margin_bottom = 10

[node name="VBoxContainer" type="VBoxContainer" parent="CanvasLayer/StatScreen/MarginContainer/Columns/Items/PanelContainer2/MarginContainer"]
layout_mode = 2

[node name="TotalGensLabel" type="Label" parent="CanvasLayer/StatScreen/MarginContainer/Columns/Items/PanelContainer2/MarginContainer/VBoxContainer"]
layout_mode = 2
text = "Generation: --"

[node name="TimeElapsedLabel" type="Label" parent="CanvasLayer/StatScreen/MarginContainer/Columns/Items/PanelContainer2/MarginContainer/VBoxContainer"]
layout_mode = 2
text = "Time elapsed: --"

[node name="PanelContainer" type="PanelContainer" parent="CanvasLayer/StatScreen/MarginContainer/Columns/Items"]
layout_mode = 2
theme_override_styles/panel = SubResource("StyleBoxFlat_xt7i1")

[node name="MarginContainer" type="MarginContainer" parent="CanvasLayer/StatScreen/MarginContainer/Columns/Items/PanelContainer"]
layout_mode = 2
theme_override_constants/margin_left = 10
theme_override_constants/margin_top = 10
theme_override_constants/margin_right = 10
theme_override_constants/margin_bottom = 10

[node name="VBoxContainer" type="VBoxContainer" parent="CanvasLayer/StatScreen/MarginContainer/Columns/Items/PanelContainer/MarginContainer"]
layout_mode = 2

[node name="GenLabel" type="Label" parent="CanvasLayer/StatScreen/MarginContainer/Columns/Items/PanelContainer/MarginContainer/VBoxContainer"]
layout_mode = 2
text = "Generation: --"

[node name="BatchLabel" type="Label" parent="CanvasLayer/StatScreen/MarginContainer/Columns/Items/PanelContainer/MarginContainer/VBoxContainer"]
layout_mode = 2
text = "Batch Progress: --"

[node name="TimerLabel" type="Label" parent="CanvasLayer/StatScreen/MarginContainer/Columns/Items/PanelContainer/MarginContainer/VBoxContainer"]
layout_mode = 2
text = "Time remaining: --"

[node name="ImprovementLabel" type="Label" parent="CanvasLayer/StatScreen/MarginContainer/Columns/Items/PanelContainer/MarginContainer/VBoxContainer"]
layout_mode = 2
text = "Gens without improvement: --"

[node name="SinceRandomizedLabel" type="Label" parent="CanvasLayer/StatScreen/MarginContainer/Columns/Items/PanelContainer/MarginContainer/VBoxContainer"]
layout_mode = 2
text = "Since Last Randomized: --"

[node name="VBoxContainer" type="VBoxContainer" parent="CanvasLayer/StatScreen/MarginContainer/Columns/Items"]
layout_mode = 2
size_flags_vertical = 3

[node name="VBoxContainer" type="VBoxContainer" parent="CanvasLayer/StatScreen/MarginContainer/Columns/Items/VBoxContainer"]
layout_mode = 2
size_flags_vertical = 10
alignment = 2

[node name="HBoxContainer" type="HBoxContainer" parent="CanvasLayer/StatScreen/MarginContainer/Columns/Items/VBoxContainer/VBoxContainer"]
layout_mode = 2

[node name="SavePathEdit" type="TextEdit" parent="CanvasLayer/StatScreen/MarginContainer/Columns/Items/VBoxContainer/VBoxContainer/HBoxContainer"]
layout_mode = 2
size_flags_horizontal = 3
text = "user://saved_networks.json"
placeholder_text = "Save Path"
scroll_fit_content_height = true

[node name="BrowseButton" type="Button" parent="CanvasLayer/StatScreen/MarginContainer/Columns/Items/VBoxContainer/VBoxContainer/HBoxContainer"]
layout_mode = 2
text = "Browse"

[node name="ButtonRow" type="HBoxContainer" parent="CanvasLayer/StatScreen/MarginContainer/Columns/Items/VBoxContainer/VBoxContainer"]
process_mode = 3
layout_mode = 2
size_flags_horizontal = 0
size_flags_vertical = 8

[node name="PauseButton" type="Button" parent="CanvasLayer/StatScreen/MarginContainer/Columns/Items/VBoxContainer/VBoxContainer/ButtonRow"]
layout_mode = 2
text = "Pause"

[node name="SaveButton" type="Button" parent="CanvasLayer/StatScreen/MarginContainer/Columns/Items/VBoxContainer/VBoxContainer/ButtonRow"]
layout_mode = 2
text = "Save"

[node name="ScrollContainer2" type="ScrollContainer" parent="CanvasLayer/StatScreen/MarginContainer/Columns"]
layout_mode = 2
size_flags_horizontal = 3

[node name="Items" type="VBoxContainer" parent="CanvasLayer/StatScreen/MarginContainer/Columns/ScrollContainer2"]
layout_mode = 2
size_flags_horizontal = 3

[node name="Graph" parent="CanvasLayer/StatScreen/MarginContainer/Columns/ScrollContainer2/Items" instance=ExtResource("3_q1c5e")]
layout_mode = 2
resolution = 1000
metadata/_edit_use_anchors_ = true

[node name="Graph2" parent="CanvasLayer/StatScreen/MarginContainer/Columns/ScrollContainer2/Items" instance=ExtResource("3_q1c5e")]
layout_mode = 2
resolution = 1000
metadata/_edit_use_anchors_ = true

[node name="VFlowContainer" type="VFlowContainer" parent="CanvasLayer/StatScreen/MarginContainer/Columns"]
layout_mode = 2

[node name="PopoutButton" type="Button" parent="CanvasLayer/StatScreen/MarginContainer/Columns/VFlowContainer"]
custom_minimum_size = Vector2(40, 40)
layout_mode = 2
icon = ExtResource("10_roe6o")
icon_alignment = 1
expand_icon = true

[node name="PopoutComponent" type="Node" parent="CanvasLayer/StatScreen"]
script = ExtResource("11_87okm")
window_title = "Stats"
keep_position = true
relative_position = true
keep_size = true
relative_size = true

[connection signal="child_entered_tree" from="NeuralAPIClient" to="NeuralAPIClient" method="_on_child_entered_tree"]
[connection signal="generation_countown_updatad" from="NeuralAPIClient/NeuralCarManager" to="." method="_on_generation_countown_updatad"]
[connection signal="networks_randomized" from="NeuralAPIClient/NeuralCarManager" to="." method="_on_neural_car_manager_networks_randomized"]
[connection signal="new_generation" from="NeuralAPIClient/NeuralCarManager" to="." method="_on_car_manager_new_generation"]
[connection signal="reset" from="NeuralAPIClient/NeuralCarManager" to="." method="_on_neural_car_manager_reset"]
[connection signal="pressed" from="CanvasLayer/StatScreen/MarginContainer/Columns/Items/VBoxContainer/VBoxContainer/HBoxContainer/BrowseButton" to="." method="_on_browse_button_pressed"]
[connection signal="pressed" from="CanvasLayer/StatScreen/MarginContainer/Columns/Items/VBoxContainer/VBoxContainer/ButtonRow/PauseButton" to="." method="_on_pause_button_pressed"]
[connection signal="pressed" from="CanvasLayer/StatScreen/MarginContainer/Columns/Items/VBoxContainer/VBoxContainer/ButtonRow/SaveButton" to="." method="_on_save_button_pressed"]
[connection signal="pressed" from="CanvasLayer/StatScreen/MarginContainer/Columns/VFlowContainer/PopoutButton" to="." method="_on_popout_button_pressed"]
[connection signal="popout_state_changed" from="CanvasLayer/StatScreen/PopoutComponent" to="." method="_on_stat_screen_popout_state_changed"]
